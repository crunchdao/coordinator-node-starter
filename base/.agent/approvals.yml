# Machine-readable approval gates for agent tooling.
# Human-readable policy is in policy.md â€” this file is the enforceable subset.

requires_approval:
  - name: "On-chain / emission logic"
    match:
      paths:
        - "**/runtime_definitions/crunch_config.py"  # only build_emission, crunch_pubkey, provider fields
        - "**/emission_strategies.py"
      keywords: ["build_emission", "frac64", "crunch_pubkey", "compute_provider", "data_provider", "reward_pct"]

  - name: "DB schema changes"
    match:
      paths:
        - "**/alembic/versions/**"
        - "**/db/tables/**"
        - "**/*.sql"

  - name: "Auth / security"
    match:
      paths:
        - "**/middleware/auth.py"
        - "**/.production.env*"
      keywords: ["API_KEY", "API_READ_AUTH", "API_PUBLIC_PREFIXES", "API_ADMIN_PREFIXES"]

  - name: "Infrastructure"
    match:
      paths:
        - "**/docker-compose.yml"
        - "**/Dockerfile"
        - "**/.github/workflows/**"
        - "**/deployment/**"

  - name: "Cryptography / wallets"
    match:
      paths:
        - "**/merkle/**"
        - "**/*.json"  # wallet keypair files
      keywords: ["keypair", "wallet", "private_key", "secret_key"]

allowed_operations:
  commands:
    allow:
      - "make deploy"
      - "make verify-e2e"
      - "make logs"
      - "make logs-capture"
      - "make down"
      - "make backfill"
      - "uv run python -m pytest"
    deny:
      - "rm -rf"
      - "terraform apply"
      - "docker system prune"

  filesystem:
    free_edit:
      - "node/runtime_definitions/**"
      - "node/config/**"
      - "node/api/**"
      - "node/extensions/**"
      - "node/plugins/**"
      - "challenge/starter_challenge/**"
    never_delete:
      - "**/.production.env*"
      - "**/wallet*.json"
      - "**/alembic/versions/**"
      - "node/data/**"
